<!DOCTYPE html>
<html lang="en">
<head>
  <title>Charitable Impact – QA Intelligence</title>
  <style>
    body { font-family: Arial; margin: 40px; }
    h2 { margin-bottom: 5px; }
    section { border: 1px solid #ddd; padding: 15px; margin-bottom: 20px; }
    textarea { width: 100%; }
    button { margin-top: 10px; }
    pre { background: #f6f6f6; padding: 10px; white-space: pre-wrap; }
  </style>
</head>
<body>

<h1>Charitable Impact – QA Intelligence Platform</h1>
<p>Plan → Design → Automate → Analyze</p>

<!-- ========================= -->
<section>
<h2>1️⃣ Upload Test Plan</h2>
<input type="file" id="testplanFile" />
<button onclick="uploadTestPlan()">Upload & Analyze</button>
</section>

<!-- ========================= -->
<section>
<h2>2️⃣ Generate Manual Test Cases</h2>
<p>Based on uploaded Test Plan</p>
<button onclick="generateManual()">Generate Manual Test Cases</button>
</section>

<!-- ========================= -->
<section>
<h2>3️⃣ Generate Automation Test Assets</h2>
<select id="automationType">
  <option value="api">API – Postman</option>
  <option value="ui">UI – Java Selenium POM</option>
  <option value="perf">Performance – JMeter</option>
</select>
<button onclick="generateAutomation()">Generate</button>
</section>

<!-- ========================= -->
<section>
<h2>4️⃣ Upload Execution Results</h2>
<input type="file" id="resultsFile" />
<button onclick="uploadResults()">Upload Results</button>
</section>

<!-- ========================= -->
<section>
<h2>5️⃣ QA Summary & Next Steps</h2>
<button onclick="generateSummary()">Generate QA Summary</button>
</section>

<h2>Output</h2>
<pre id="output"></pre>

<script>
const API_URL = "https://YOUR-WORKER-NAME.workers.dev";
let testPlanText = "";
let executionResults = "";

// -------------------------------
function readFile(file) {
  return new Promise(res => {
    const reader = new FileReader();
    reader.onload = () => res(reader.result);
    reader.readAsText(file);
  });
}

// -------------------------------
async function uploadTestPlan() {
  const file = document.getElementById("testplanFile").files[0];
  if (!file) return alert("Upload test plan first");

  testPlanText = await readFile(file);

  const res = await callAPI("plan", testPlanText);
  showResponse(res);

}

// -------------------------------
async function generateManual() {
  if (!testPlanText) return alert("Upload test plan first");
  setLoading(true);
  const res = await callAPI("manual", testPlanText);
  setLoading(false);
  showResponse(res);
}

// -------------------------------
async function generateAutomation() {
  const type = document.getElementById("automationType").value;
  const actionMap = {
    api: "postman",
    ui: "java",
    perf: "jmeter"
  };
  const res = await callAPI(actionMap[type], testPlanText);
  showResponse(res);

}

// -------------------------------
async function uploadResults() {
  const file = document.getElementById("resultsFile").files[0];
  if (!file) return alert("Upload execution results");
  executionResults = await readFile(file);
  show("Results uploaded successfully.");
}

// -------------------------------
async function generateSummary() {
  if (!executionResults) return alert("Upload execution results first");
  const res = await callAPI("summary", executionResults);
  showResponse(res);

}

// -------------------------------
async function callAPI(action, content) {
  const res = await fetch(API_URL, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      url: "my.charitableimpact.com",
      action,
      goal: content
    })
  });
  return await res.json();
}

// -------------------------------
function show(text) {
  document.getElementById("output").innerText = text;
}

function showResponse(data) {
  const out = document.getElementById("output");
  out.textContent = data.content;

  const mimeMap = {
    xml: "application/xml",
    json: "application/json",
    jmx: "application/xml",
    txt: "text/plain"
  };

  const ext = data.filename.split(".").pop();
  const mime = mimeMap[ext] || "text/plain";

  const link = document.createElement("a");
  link.href = URL.createObjectURL(
    new Blob([data.content], { type: mime })
  );
  link.download = data.filename;
  link.innerText = "⬇ Download " + data.filename;

  out.appendChild(document.createElement("hr"));
  out.appendChild(link);
}
function setLoading(isLoading) {
  document.body.style.opacity = isLoading ? "0.6" : "1";
}

</script>

</body>
</html>
